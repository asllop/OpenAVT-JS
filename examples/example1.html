<html>
<head>
    <!-- OpenAVT -->
    <script src="/dist/umd/openavt.js"></script>
</head>
<body>
    <script>
        OpenAVT.OAVTLog.setLogLevel(OpenAVT.LogLevel.Verbose)
        OpenAVT.OAVTLog.verbose("Hello Example1");

        let fakeTracker = {
            instrument: null,
            trackerId: null,
            state: new OpenAVT.OAVTState(),
            endOfService: function() {
                console.log("Fake Tracker enfOfService")
            },
            instrumentReady: function(instrument) {
                if (this.instrument == null) {
                    this.instrument = instrument
                    console.log("Fake Tracker instrumentReady", instrument)
                    instrument.registerGetter(new OpenAVT.OAVTAttribute("attrName"), this.attrGetter.bind(this), this)
                }
            },
            initEvent: function(ev) {
                console.log("Fake Tracker initEvent", ev)
                console.log("CALL GETTER = " + this.instrument.callGetter(new OpenAVT.OAVTAttribute("attrName"), this))
                this.instrument.useGetter(new OpenAVT.OAVTAttribute("attrName"), ev, this)
                return ev
            },
            attrGetter: function() {
                console.log("Called attrGetter", this)
                return "attrValue from tracker " + this.trackerId
            }
        }

        let fakeHub = {
            endOfService: function() {
                console.log("Fake Hub enfOfService")
            },
            instrumentReady: function(instrument) {
                console.log("Fake Hub instrumentReady", instrument)
            },
            processEvent: function(ev, tracker) {
                console.log("Fake Hub processEvent", ev, tracker)
                return ev
            }
        }
        
        let fakeBackend = {
            endOfService: function() {
                console.log("Fake Backend enfOfService")
            },
            instrumentReady: function(instrument) {
                console.log("Fake Backend instrumentReady", instrument)
            },
            sendEvent: function(ev) {
                console.log("Fake Backend sendEvent", ev)
            },
            sendMetric: function(mt) {
                console.log("Fake Backend sendMetric", mt)
            }
        }
        
        let instrument = new OpenAVT.OAVTInstrument(fakeHub, fakeBackend);
        let trackerId = instrument.addTracker(fakeTracker);
        instrument.ready()

        instrument.emit(OpenAVT.OAVTAction.Ping, instrument.getTracker(trackerId))
    </script>
</body>
</html>
